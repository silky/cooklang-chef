import{A as r}from"./constants.f8e48017.js";import{g as p,i as a}from"./navigation.588d61a7.js";import{p as d}from"./stores.761b9a39.js";import{k as w,w as R}from"./singletons.6e90558e.js";import{a as i}from"./toast.b46198b7.js";import{k as l}from"./scheduler.72b97259.js";const o=R("pending"),y=w(o);let e=null;function E(){const m=`${r}/updates`,n=l(d).url,u=`${n.protocol.replace("http","ws")}//${n.host}`,f=new URL(m,u);return e=new WebSocket(f),e.addEventListener("open",()=>o.set("connected")),e.addEventListener("message",g=>{const t=JSON.parse(g.data);console.log(t);let s=t.path.replace(".cook","").replace("\\","/");const c=l(d).url.searchParams.get("r")===s;if(t.type==="deleted"&&c)return i.error("Recipe deleted"),p("/");if(t.type==="renamed"&&c)return i.success("Renamed recipe"),p("/recipe?"+new URLSearchParams({r:t.to.replace(".cook","")}));a(`${r}/recipe`),a(`${r}/recipe/metadata`),a(h=>decodeURI(h.pathname).endsWith(s))}),e.addEventListener("close",()=>{o.set("disconnected")}),()=>{e&&e.close()}}export{y as a,E as c};
